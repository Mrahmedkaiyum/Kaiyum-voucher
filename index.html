<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAIYUM - Premium Voucher System</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        :root { --gold: #D4AF37; --dark: #121212; --card: #1E1E1E; --red: #D32F2F; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: var(--dark); color: white; overflow: hidden; height: 100vh; display: flex; justify-content: center; }

        #app-wrap { width: 100%; max-width: 450px; height: 100vh; background: var(--dark); position: relative; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        /* ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶∂ ‡¶≤‡¶ó‡¶á‡¶® */
        .auth-screen { position: absolute; inset: 0; background: var(--dark); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .logo-box { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 20px; box-shadow: 0 0 20px var(--gold); }
        
        .iti { width: 100%; margin-bottom: 15px; }
        input { width: 100%; padding: 14px; background: #222; border: 1px solid #333; border-radius: 12px; color: white; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--gold); }
        .main-btn { width: 100%; padding: 15px; background: var(--gold); color: black; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }

        /* ‡¶≠‡¶æ‡¶â‡¶ö‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        header { padding: 20px; background: var(--card); border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .voucher-container { padding: 15px; overflow-y: auto; height: calc(100vh - 80px); }
        .v-card { background: linear-gradient(135deg, #2a2a2a, #1a1a1a); padding: 20px; border-radius: 20px; border: 1px solid #333; margin-bottom: 15px; position: relative; overflow: hidden; }
        .v-card::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(212,175,55,0.1), transparent); pointer-events: none; }
        .v-title { color: var(--gold); font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .v-price { font-size: 24px; font-weight: 900; margin: 10px 0; }
        .v-btn { padding: 8px 20px; background: var(--gold); color: black; border: none; border-radius: 8px; font-weight: bold; float: right; }

        /* OTP ‡¶ì‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶≤‡ßá */
        #otp-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
    </style>
</head>
<body>

<div id="app-wrap">
    
    <div id="auth-scr" class="auth-screen">
        <img src="https://image2url.com/r2/default/images/1770055773770-4e97be2e-90a9-48f4-b20b-bb418a6d3c91.jpg" class="logo-box">
        <h2 style="color:var(--gold)">KAIYUM VOUCHER</h2>
        <p style="color:#888; font-size:14px; margin-bottom:30px;">Premium Digital Assets Access</p>
        
        <input type="tel" id="user-ph">
        <input type="text" id="user-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" style="margin-top:10px;">
        <input type="password" id="user-ps" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" style="margin-top:10px;">
        
        <button class="main-btn" onclick="startRegistration()">‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® / ‡¶≤‡¶ó‡¶á‡¶®</button>
    </div>

    <div id="otp-overlay">
        <h3 style="color:var(--gold)">OTP ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</h3>
        <p style="font-size:13px; color:#aaa;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶®‡¶ø‡¶§‡ßá KAIYUM-‡¶ï‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡¶ø‡¶®</p>
        <input type="number" id="otp-input" placeholder="‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®" style="text-align:center; font-size:20px; letter-spacing:10px;">
        <button class="main-btn" onclick="verifyOTP()">‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <a id="wa-otp-link" href="#" target="_blank" style="color:var(--gold); text-decoration:none; margin-top:20px; font-size:14px;">üí¨ WhatsApp-‡¶è ‡¶ï‡ßã‡¶° ‡¶ö‡¶æ‡¶®</a>
    </div>

    <div id="main-app" style="display:none;">
        <header>
            <span style="color:var(--gold); font-weight:bold;">Welcome, <span id="display-name">User</span></span>
            <button onclick="logout()" style="background:none; border:1px solid #444; color:white; padding:5px 10px; border-radius:5px; font-size:12px;">Logout</button>
        </header>

        <div class="voucher-container">
            <div class="v-card">
                <div class="v-title">VIP Access Voucher</div>
                <div class="v-price">$50.00</div>
                <div style="font-size:12px; color:#888;">Validity: 30 Days | Instant Delivery</div>
                <button class="v-btn">Buy Now</button>
            </div>

            <div class="v-card">
                <div class="v-title">Premium Gold Token</div>
                <div class="v-price">$120.00</div>
                <div style="font-size:12px; color:#888;">Validity: Lifetime | Limited Edition</div>
                <button class="v-btn">Buy Now</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó
    const firebaseConfig = { databaseURL: "https://kbook-5d175-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ADMIN_WA = "9660558687975";

    let iti;
    let tempUserData = null;

    window.onload = () => {
        const input = document.querySelector("#user-ph");
        iti = window.intlTelInput(input, {
            separateDialCode: true,
            initialCountry: "sa",
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
        });

        if(localStorage.getItem("lb_phone")) {
            showDashboard();
        }
    };

    // ‡ßß. ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ
    function startRegistration() {
        const ph = iti.getNumber();
        const name = document.getElementById('user-name').value;
        const pass = document.getElementById('user-ps').value;

        if(!iti.isValidNumber() || !name || !pass) return alert("‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ò‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");

        const userKey = btoa(ph);
        
        // ‡¶Ü‡¶ó‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ
        db.ref('users/' + userKey).once('value', snap => {
            if(snap.exists()) {
                // ‡¶≤‡¶ó‡¶á‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
                if(snap.val().pass === pass) {
                    localStorage.setItem("lb_phone", userKey);
                    showDashboard();
                } else {
                    alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!");
                }
            } else {
                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü - OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá
                let otp = Math.floor(1000 + Math.random() * 9000).toString();
                tempUserData = { ph, name, pass, otp };
                
                // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶∏‡ßá‡¶≠
                db.ref('otp_requests/' + userKey).set({ name, otp, ph });

                // ‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø
                const msg = `Assalamu Alaikum KAIYUM,\n‡¶Ü‡¶Æ‡¶ø ‡¶≠‡¶æ‡¶â‡¶ö‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§\n‡¶®‡¶æ‡¶Æ: ${name}\n‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞: ${ph}\n‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®‡•§`;
                document.getElementById('wa-otp-link').href = `https://wa.me/${ADMIN_WA}?text=${encodeURIComponent(msg)}`;
                
                document.getElementById('otp-overlay').style.display = 'flex';
            }
        });
    }

    // ‡ß®. ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßá ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠
    function verifyOTP() {
        const inputOTP = document.getElementById('otp-input').value;
        if(inputOTP === tempUserData.otp) {
            const userKey = btoa(tempUserData.ph);
            db.ref('users/' + userKey).set({
                name: tempUserData.name,
                pass: tempUserData.pass,
                phone: tempUserData.ph,
                joined: Date.now()
            });
            localStorage.setItem("lb_phone", userKey);
            location.reload();
        } else {
            alert("‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßã‡¶°! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
    }

    function showDashboard() {
        document.getElementById('auth-scr').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        
        const myKey = localStorage.getItem("lb_phone");
        db.ref('users/' + myKey).once('value', snap => {
            if(snap.exists()) {
                document.getElementById('display-name').innerText = snap.val().name;
            }
        });
    }

    function logout() {
        localStorage.clear();
        location.reload();
    }
</script>
</body>
</html>
